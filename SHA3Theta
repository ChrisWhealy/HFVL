# visualization for theta in keccak f function
# input: a
Frame 1:
    $modifyTitle(text='Theta Function Visualization', color='red')

    $drawBox(aInput,   55, 860, 1055,  90, text='A bytes')
    $drawBox(desc,   1120, 810,  340, 140, text='Description of events')
    $drawBox(cFunc,    55, 680,  200,  90, text='C function')
    $drawBox(dFunc,    55, 500,  200,  90, text='D function')
    $drawBox(aInput2, 275, 500, 1055,  90, text='A bytes')
    $drawBox(xorLoop,  55, 290,  860,  90, text='XOR Loop')
    $drawBox(oby,      55,  90, 1055,  90, text='Theta output')

    $drawArrow(aInput, cFunc)
    $drawArrow(cFunc, dFunc)
    $drawArrow(dFunc, xorLoop)
    $drawArrow(aInput2, xorLoop)
    $drawArrow(xorLoop, oby)
Frame End

Frame 2:
    $modifyBox(desc, color=blue, text='Take the initial A block as input and start out with this value. This will be input to the xor loop and C functions.')
    $modifyBox(aInput, color=blue, bold=true, text=*a)
    $modifyBox(aInput2, color=blue, bold=true, text=*a)
Frame End

Frame 3:
    $resetBox(desc)
    $resetBox(aInput)
    $resetBox(aInput2)
Frame End

Frame 4:
    $modifyBox(desc, color=blue, text='Take the A block and input it into the C function. Click on the C function box to view bit details. This function is simplified as\ for x in (0..4):\ C[x]: A[x][0] xor A[x][1] xor A[x][2] xor A[x][3] xor A[x][4]')
    $modifyBox(aInput, color=green, bold=true)
    $modifyArrow(aInput,cFunc,color=green)
Frame End

Frame 5:
    $modifyBox(cFunc, color=red, bold=true, link='SHA3ThetaC', input=a)
Frame End

Frame 6:
    $modifyBox(cFunc, text=@cfunc(*a))
Frame End

Frame 7:
    $resetBox(desc)
    $resetBox(cFunc)
    $resetBox(aInput)
    $resetArrow(aInput,cFunc)
Frame End

Frame 8:
    $modifyBox(desc, color=blue, text='Take the C block and input it into the dFunc function. Click on the dFunc function box to learn more. This function is simplified as\ for x in (0..4):\ D[x]: C[x-1] xor (right rotate 1(C[x+1])')
    $modifyBox(cFunc, color=green, bold=true)
    $modifyArrow(cFunc,dFunc,color=green)
Frame End

Frame 9:
    $modifyBox(dFunc, color=red, bold=true, link='SHA3ThetaD', input=cFunc)
Frame End

Frame 10:
    $modifyBox(dFunc, text=@dfunc(*cFunc))
Frame End

Frame 11:
    $resetBox(desc)
    $resetBox(cFunc)
    $resetBox(dFunc)
    $resetArrow(cFunc,dFunc)
Frame End

Frame 12:
    $modifyBox(desc, color=blue, text='Take the initial A block and dFunc function output as input to the XOR Loop. Click on the XOR loop box to learn more. This loop is simplified as\ for x in (0..4):\ for y in (0..4):\ A[x][y]: A[x][y] xor D[x]')
    $modifyBox(dFunc, color=green, bold=true)
    $modifyBox(aInput2, color=green, bold=true)
    $modifyArrow(dFunc,xorLoop,color=green)
    $modifyArrow(aInput2,xorLoop,color=green)
Frame End

Frame 13:
    $modifyBox(xorLoop, color=red, bold=true, link='SHA3ThetaXor', input=aInput2;dFunc)
Frame End

Frame 14:
    $modifyBox(xorLoop, text=@xorloop(*aInput2;*dFunc))
Frame End

Frame 15:
    $resetBox(desc)
    $resetBox(xorLoop)
    $resetBox(aInput2)
    $resetBox(dFunc)
    $resetArrow(dFunc,xorLoop)
    $resetArrow(aInput2,xorLoop)
Frame End

Frame 16:
    $modifyBox(desc, color=blue, text='Take the initial XOR Loop output as our output byte block for the entire Theta step. We have now finished the Theta function in Keccak-f[1600]')
    $modifyBox(xorLoop, color=blue, bold=true)
    $modifyArrow(xorLoop,oby,color=blue)
Frame End

Frame 17:
    $modifyBox(oby, color=blue, bold=true, text=@groupAsI64(*xorLoop))
Frame End

Frame 18:
    $resetBox(desc)
    $resetBox(xorLoop)
    $resetArrow(xorLoop,oby)
    $modifyBox(oby, color=red)
Frame End
